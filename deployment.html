<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Deployment Guide &#8212; exodus-gw  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=1fc5d657" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development Guide" href="development.html" />
    <link rel="prev" title="API Reference" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="deployment-guide">
<span id="deploy-guide"></span><h1>Deployment Guide<a class="headerlink" href="#deployment-guide" title="Link to this heading">¶</a></h1>
<section id="target-platform">
<h2>Target platform<a class="headerlink" href="#target-platform" title="Link to this heading">¶</a></h2>
<p>exodus-gw is an ASGI application which may be deployed using any ASGI-compliant
web server. The development team’s recommended setup is summarized as:</p>
<ul>
<li><p>Use OpenShift &gt;= 4.x to deploy the service.</p></li>
<li><p>Use the exodus-gw images at <a class="reference external" href="https://quay.io/repository/exodus/exodus-gw">https://quay.io/repository/exodus/exodus-gw</a> to run
the service. These images run the service using gunicorn &amp; uvicorn on RHEL8.</p>
<p>In general, the
<a class="reference external" href="https://www.uvicorn.org/deployment/">uvicorn deployment advice</a>
applies.</p>
</li>
<li><p>Deploy the service’s primary container behind a reverse-proxy implementing
authentication according to your organization’s needs (see next section).</p></li>
</ul>
</section>
<section id="authentication-authorization">
<h2>Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Link to this heading">¶</a></h2>
<p>The exodus-gw service does not implement any authentication mechanism. It is instead
designed to integrate with a reverse-proxy implementing any desired mechanism.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If exodus-gw is deployed without an authenticating reverse-proxy, the service must
be considered completely unsecured - all users will be able to perform all operations.</p>
</div>
<p>This reverse-proxy must add an <code class="docutils literal notranslate"><span class="pre">X-RhApiPlatform-CallContext</span></code> header onto all incoming
requests. This header must contain a base64-encoded form of the following JSON object:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;client&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;someRole&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;anotherRole&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;authenticated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;serviceAccountId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;clientappname&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;viewer&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;authenticated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;internalUsername&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;someuser&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">roles</span></code> and <code class="docutils literal notranslate"><span class="pre">authenticated</span></code> fields influence whether an exodus-gw request will be
permitted - the necessary roles are documented on relevant exodus-gw API endpoints.
Other fields are unused or used only for logging.</p>
<p>The separate <code class="docutils literal notranslate"><span class="pre">client</span></code> and <code class="docutils literal notranslate"><span class="pre">user</span></code> fields can be used to separate service accounts
(machine users) from human users, but this does not affect exodus-gw.</p>
<p>Within Red Hat, a container known as “platform-sidecar” is used as the reverse proxy - consult
internal documentation for information on this component. In other contexts, any reverse
proxy may be used as long as it produces headers according to the scheme documented above.</p>
</section>
<section id="database-migrations">
<h2>Database Migrations<a class="headerlink" href="#database-migrations" title="Link to this heading">¶</a></h2>
<p>The exodus-gw service uses a postgres database.</p>
<p>On startup, the service will run database migrations to ensure the DB implements the
required schema.</p>
<p>It is a goal that migrations can be performed online with minimal disruption to the
service, even with old and new versions of the service running simultaneously
(for example, during an OpenShift rolling deployment).</p>
<p>Downgrading to an earlier version of the schema is not directly supported by the
service. However, as exodus-gw is designed not to store any permanent state, dropping
and recreating the exodus-gw database is a viable option if needed.</p>
</section>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Link to this heading">¶</a></h2>
<p>To enable per-environment configuration of exodus-gw, exodus-gw.ini is available to point the
application at specific AWS resources and declare the AWS profile to use when interacting with
those resources. Each environment must appear in its own section with the prefix “env.”.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[env.prod]</span>
<span class="na">aws_profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">production</span>
<span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cdn-prod-s3</span>
<span class="na">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cdn-prod-db</span>
</pre></div>
</div>
<p>Logger levels may also be configured via exodus-gw.ini. Under a section named “loglevels”,
users may specify a logger name and the level at which to set said logger.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[loglevels]</span>
<span class="na">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">NOTSET</span>
<span class="na">exodus-gw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">INFO</span>
<span class="na">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">DEBUG</span>
<span class="na">...</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">exodus-gw</a></h1>



<p class="blurb">Publishing microservice for Red Hat's Content Delivery Network</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Deployment Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#target-platform">Target platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authentication-authorization">Authentication &amp; Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#database-migrations">Database Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#settings">Settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Guide</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/release-engineering/exodus-gw">Source</a></li>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">API Reference</a></li>
      <li>Next: <a href="development.html" title="next chapter">Development Guide</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Red Hat.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/deployment.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/release-engineering/exodus-gw" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>